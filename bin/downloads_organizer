#!/bin/bash
#0 * * * * /home/anshup/bin/downloads_organizer &>/dev/null
#redirect all o/p to dev null to avoid sending out any emails
set -x
basedir="$HOME/Downloads"
cd $basedir

cnm() {
  if [ ! -d $basedir ]
    then mkdir -p $basedir
  fi

}

date_day=`date +%d`
if [ $date_day == "01" ] 
then
  month=`date -v-1d +%m`
else
  month=`date +%m`
fi

date_month=`date +%m`

if  ([ $date_day == "01" ] && [ $date_month == "01" ] ) 
then
    year=year=`date -v-1d +%Y`
else
    year=`date +%Y`
fi

folderpath="$year/$month"
basedir="$basedir/all/$folderpath"

cnm

depthparam=" -depth 1"
if [ $OSTYPE == "linux-gnu" ]
then
  depthparam=" -maxdepth 1"
fi
if [ ! -d `date +%F` ]
then
  rm dailydownload
  find . ${depthparam} -not -name 'all' -not -name '.*' -exec mv {} ${basedir} \;
  mkdir `date +%F`
  ln -s `date +%F` dailydownload
fi

## Screenshots management

#month and year need to be set to today for 01 and 01/01 scenarios set to yday above
month=`date +%m`
year=`date +%Y`
folderpath="$year/$month"

cd ~/Desktop
basedir="$HOME/tmp/screenshots/"
basedir="$basedir/all/$folderpath"


if [[ `ls|grep Screen|wc -l ` -gt 0 ]]
then
  today=`date +%F`
  basedir=$basedir/$today
  cnm
  mv -v Screen* $basedir
fi

## brew upgrade
hour=`date +%H`

if [[ $hour -eq 15 ]]
then
  brew upgrade
  fi